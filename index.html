<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gem System v18.0 - System Resonance</title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --solo-blue: #3d5afe; --solo-cyan: #00e5ff;
            --panel-bg: #0a0c12; --system-red: #ff3d3d;
            --system-green: #00ff88; --recovery-gold: #ffcc00;
            --hp-orange: #ff6d00;
        }

        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            background: #05070a radial-gradient(circle at center, #0d1233 0%, #000 100%);
            font-family: 'Rajdhani', sans-serif; color: #fff;
            display: flex; align-items: center; justify-content: center; overflow-x: hidden;
        }

        .hidden { display: none !important; }

        /* --- AUTHENTIFICATION --- */
        #login-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.98); display: flex; align-items: center; justify-content: center; z-index: 50000; padding: 20px; }
        .login-card { background: var(--panel-bg); padding: 30px; border-radius: 20px; border: 1px solid var(--solo-cyan); text-align: center; width: 100%; max-width: 340px; box-shadow: 0 0 30px rgba(0, 229, 255, 0.2); }
        .login-input { width: 100%; padding: 15px; background: #111; border: 1px solid #222; color: #fff; margin-bottom: 15px; text-align: center; border-radius: 8px; font-family: 'Rajdhani'; outline: none; box-sizing: border-box; }

        /* --- HUD PRINCIPAL --- */
        #hud-window { width: 90%; max-width: 440px; background: var(--panel-bg); border: 1px solid rgba(0, 229, 255, 0.1); border-radius: 28px; padding: 25px; position: relative; box-sizing: border-box; }
        .logout-btn { position: absolute; top: 20px; right: 20px; background: none; border: 1px solid var(--system-red); color: var(--system-red); border-radius: 50%; width: 28px; height: 28px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 12px; }
        
        #recovery-widget { position: absolute; top: 60px; right: 20px; width: 80px; text-align: center; border: 2px solid var(--recovery-gold); border-radius: 12px; padding: 8px 5px; background: rgba(255, 204, 0, 0.1); cursor: pointer; z-index: 10; }

        .bio-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin: 20px 0; }
        .bio-card { background: rgba(255,255,255,0.02); padding: 12px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.05); }
        .bio-label { font-size: 9px; color: var(--solo-blue); font-weight: 700; letter-spacing: 2px; display: block; margin-bottom: 3px; }
        .bio-input { background: transparent; border: none; color: #fff; font-family: 'JetBrains Mono'; font-weight: 700; font-size: 16px; width: 100%; outline: none; }
        
        .quest-item { padding: 14px; background: rgba(255,255,255,0.02); border-radius: 10px; margin-bottom: 8px; display: flex; justify-content: space-between; font-weight: 700; font-size: 12px; border-left: 3px solid #222; color: #444; }
        .quest-item.active { border-left-color: var(--solo-cyan); color: #fff; background: rgba(0, 229, 255, 0.05); }
        
        .btn-modern { width: 100%; padding: 16px; background: var(--solo-blue); border: none; border-radius: 12px; color: #fff; font-weight: 900; letter-spacing: 3px; cursor: pointer; }
        .btn-modern:disabled { background: #1a1d26; color: #444; }

        .side-btn-system { position: absolute; right: -60px; top: 50%; transform: translateY(-50%); width: 60px; height: 80px; background: #000; border: 1px solid var(--system-red); border-left: none; border-radius: 0 20px 20px 0; color: var(--system-red); display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; }

        /* --- SYSTEM INTERFACE (RESPONSIVE) --- */
        #system-modal { position: fixed; inset: 0; background: #05070a; z-index: 20000; display: flex; align-items: center; justify-content: center; padding: 10px; }
        .os-window { width: 100%; max-width: 1000px; height: 90vh; background: #0a0c12; border: 1px solid #1a1d26; border-radius: 12px; display: flex; flex-direction: column; overflow: hidden; }
        .os-header { padding: 15px; display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; border-bottom: 1px solid #1a1d26; gap: 10px; }
        .os-body { display: flex; flex: 1; padding: 20px; overflow-y: auto; flex-direction: row; }
        
        /* Mobile adjustment for System Modal */
        @media (max-width: 768px) {
            .os-body { flex-direction: column; align-items: center; }
            .profile-side { width: 100% !important; border-right: none !important; border-bottom: 1px solid #1a1d26; padding-bottom: 20px; margin-bottom: 20px; padding-right: 0 !important; }
            #stats-content { padding-left: 0 !important; width: 100%; }
            .side-btn-system { right: 50%; top: auto; bottom: -60px; transform: translateX(50%); width: 100px; height: 50px; border-radius: 20px 20px 0 0; border: 1px solid var(--system-red); border-bottom: none; flex-direction: row; gap: 10px; }
            .rank-letter { font-size: 50px !important; }
        }

        .profile-side { width: 200px; border-right: 1px solid #1a1d26; padding-right: 25px; display: flex; flex-direction: column; align-items: center; }
        .avatar-circle-lg { width: 120px; height: 120px; border-radius: 50%; border: 3px solid var(--solo-cyan); overflow: hidden; margin-bottom: 20px; }
        .inv-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .inv-slot { height: 60px; background: rgba(255, 255, 255, 0.02); border: 1px solid rgba(0, 229, 255, 0.1); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 10px; color: #555; }
        .full-body-container { flex: 1; min-height: 300px; display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,0.3); border-radius: 15px; border: 1px dashed #333; overflow: hidden; position: relative; }
    </style>
</head>
<body>

    <div id="login-overlay">
        <div class="login-card">
            <div style="letter-spacing: 4px; color: var(--solo-cyan); margin-bottom: 25px; font-weight: 900;">AUTHENTIFICATION</div>
            <input type="text" id="hID" class="login-input" placeholder="ID CHASSEUR (GEM)">
            <input type="password" id="hPWD" class="login-input" placeholder="MOT DE PASSE">
            <button class="btn-modern" onclick="secureLogin()">S'ÉVEILLER</button>
        </div>
    </div>

    <div id="main-dashboard" class="hidden">
        <div id="hud-window">
            <button onclick="location.reload()" class="logout-btn">⏻</button>
            
            <div id="recovery-widget" onclick="toggleRestTimer()">
                <div style="font-size: 8px; color: var(--recovery-gold); font-weight: 900;">RECOVERY</div>
                <div id="rec-val" style="font-family: 'JetBrains Mono'; font-size: 14px; color:#fff;">00:30</div>
            </div>

            <div style="display: flex; gap: 15px; align-items: center;">
                <div onclick="document.getElementById('avatar-file').click()" style="width: 60px; height: 60px; border-radius: 50%; border: 2px solid var(--solo-cyan); overflow: hidden; cursor: pointer;">
                    <img id="img-hud" src="https://via.placeholder.com/80/05070a/3d5afe" style="width:100%; height:100%; object-fit:cover;">
                    <input type="file" id="avatar-file" class="hidden" accept="image/*" onchange="previewImage(this)">
                </div>
                <div>
                    <span style="font-size: 20px; font-weight: 900; letter-spacing: 2px;">GEM</span><br>
                    <span id="hud-rank" style="border: 1px solid var(--system-red); color:var(--system-red); font-size:9px; padding: 1px 6px; border-radius:4px; font-weight: bold;">RANG E</span>
                </div>
            </div>

            <div class="bio-grid">
                <div class="bio-card"><span class="bio-label">ÂGE</span><input type="number" id="age" class="bio-input" value="33" onchange="saveData()"></div>
                <div class="bio-card"><span class="bio-label">IMC</span><div id="imc" class="bio-input" style="color:var(--system-green);">--</div></div>
                <div class="bio-card"><span class="bio-label">TAILLE (CM)</span><input type="number" id="height" class="bio-input" value="186" onchange="saveData()"></div>
                <div class="bio-card"><span class="bio-label">POIDS (KG)</span><input type="number" id="weight" class="bio-input" value="80" onchange="saveData()"></div>
            </div>

            <div id="quest-container">
                <div class="quest-item" id="q1"><span>[ MISSION SCELLÉE ]</span><span>?? / ??</span></div>
                <div class="quest-item" id="q2"><span>[ MISSION SCELLÉE ]</span><span>?? / ??</span></div>
                <div class="quest-item" id="q3"><span>[ MISSION SCELLÉE ]</span><span>?? / ??</span></div>
                <div class="quest-item" id="q4"><span>[ MISSION SCELLÉE ]</span><span>?? / ??</span></div>
            </div>

            <div style="display:flex; justify-content:space-between; align-items:center; margin-top:20px; gap:10px;">
                <div id="mission-timer" style="font-family:'JetBrains Mono'; font-size:18px; color:var(--system-red); font-weight:bold;">24:00:00</div>
                <button id="accept-btn" class="btn-modern" style="flex:1; padding:12px; font-size:12px;" onclick="revealQuests()">ACCEPTER</button>
            </div>

            <div class="side-btn-system" onclick="toggleSystem()">
                <div style="font-size: 20px;">⚠️</div>
                <span style="font-size: 8px; font-weight: 900;">SYSTEM</span>
            </div>
        </div>
    </div>

    <div id="system-modal" class="hidden">
        <div class="os-window">
            <div class="os-header">
                <h2 style="color:var(--solo-cyan); margin:0; letter-spacing:2px; font-size:16px;">SYSTEM INTERFACE</h2>
                <div style="display:flex; gap:5px;">
                    <button id="btn-stats" class="tab-btn active" onclick="switchTab('stats')">STATS</button>
                    <button id="btn-inv" class="tab-btn" onclick="switchTab('inv')">INV</button>
                </div>
                <button onclick="toggleSystem()" style="background:none; border:1px solid #444; color:#888; padding:5px 10px; cursor:pointer; border-radius:4px; font-size:10px;">RETOUR</button>
            </div>
            
            <div class="os-body">
                <div class="profile-side">
                    <div class="avatar-circle-lg"><img id="img-sys" src="" style="width:100%; height:100%; object-fit:cover;"></div>
                    <h3 style="letter-spacing:4px; margin-bottom:5px;">GEM</h3>
                    <div style="width:100%; height:8px; background:#111; border-radius:4px;"><div style="width:100%; height:100%; background:var(--hp-orange); border-radius:4px;"></div></div>
                    <span style="font-size:10px; color:var(--hp-orange); font-weight:bold; margin-top:5px;">VITALITÉ : 100%</span>
                </div>

                <div id="stats-content" style="flex:1; padding-left:20px; display:flex; flex-direction:column; min-height: 400px;">
                    <div style="display:flex; justify-content:space-between; align-items:flex-start; flex-wrap: wrap;">
                        <div style="width:100%; max-width:350px; height: 300px;"><canvas id="radarChart"></canvas></div>
                        <div style="text-align:right;"><div style="font-size: 10px; color:#444;">RANK</div><div class="rank-letter" style="font-size:60px; font-weight:900; color:var(--system-red); line-height:0.8;">E</div></div>
                    </div>
                    <div style="display:flex; gap:10px; margin-top:20px;">
                        <div style="background:#0f121a; flex:1; padding:10px; border-bottom:3px solid var(--solo-cyan); font-size:12px;">STR <span id="s-str" style="float:right; color:var(--solo-cyan);">--</span></div>
                        <div style="background:#0f121a; flex:1; padding:10px; border-bottom:3px solid var(--solo-cyan); font-size:12px;">AGI <span id="s-agi" style="float:right; color:var(--solo-cyan);">--</span></div>
                        <div style="background:#0f121a; flex:1; padding:10px; border-bottom:3px solid var(--solo-cyan); font-size:12px;">VIT <span id="s-vit" style="float:right; color:var(--solo-cyan);">--</span></div>
                    </div>
                </div>

                <div id="inv-content" class="hidden" style="flex:1; padding-left:20px; display: flex; flex-direction: column; gap: 20px;">
                    <div class="full-body-container" onclick="document.getElementById('full-avatar-file').click()">
                        <img id="img-full-body" src="" style="max-height: 100%; object-fit: contain; z-index: 1;">
                        <input type="file" id="full-avatar-file" class="hidden" accept="image/*" onchange="previewFullBody(this)">
                    </div>
                    <div class="inv-grid">
                        <div class="inv-slot">CASQUE</div><div class="inv-slot">ARMURE</div>
                        <div class="inv-slot">GANTS</div><div class="inv-slot">BOTTES</div>
                        <div class="inv-slot">ARME</div><div class="inv-slot">SPECIAL</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Ta logique JS reste identique pour garder le fonctionnement parfait
        let radar, restInterval;
        const EXERCISES = [
            { n: "POMPES", u: "REP", m: 50 }, { n: "ABDOS", u: "REP", m: 50 },
            { n: "SQUATS", u: "REP", m: 50 }, { n: "TRACTIONS", u: "REP", m: 20 },
            { n: "GAINAGE", u: "SEC", m: 60 }, { n: "COURSE", u: "KM", m: 5 }
        ];

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSystemSound() {
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.type = 'square';
            oscillator.frequency.setValueAtTime(880, audioCtx.currentTime);
            gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
            oscillator.connect(gainNode); gainNode.connect(audioCtx.destination);
            oscillator.start(); oscillator.stop(audioCtx.currentTime + 0.5);
        }

        function secureLogin() {
            const id = document.getElementById('hID').value.toUpperCase();
            const pwd = document.getElementById('hPWD').value;
            if(id === "GEM" && pwd === "1234") {
                document.getElementById('login-overlay').classList.add('hidden');
                document.getElementById('main-dashboard').classList.remove('hidden');
                loadData();
            } else {
                alert("ACCÈS REFUSÉ");
            }
        }

        function toggleRestTimer() {
            let display = document.getElementById('rec-val');
            let timeLeft = 30;
            clearInterval(restInterval);
            restInterval = setInterval(() => {
                timeLeft--;
                display.innerText = `00:${timeLeft.toString().padStart(2, '0')}`;
                display.style.color = "#ff3d3d";
                if (timeLeft <= 0) {
                    clearInterval(restInterval);
                    display.innerText = "00:30";
                    display.style.color = "#fff";
                    playSystemSound();
                }
            }, 1000);
        }

        function revealQuests() {
            document.getElementById('accept-btn').disabled = true;
            document.getElementById('accept-btn').style.opacity = "0.5";
            let totalSeconds = 24 * 3600;
            setInterval(() => {
                totalSeconds--;
                if(totalSeconds < 0) return;
                let h = Math.floor(totalSeconds / 3600), m = Math.floor((totalSeconds % 3600) / 60), s = totalSeconds % 60;
                document.getElementById('mission-timer').innerText = `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
            }, 1000);

            const shuffled = [...EXERCISES].sort(() => 0.5 - Math.random()).slice(0, 4);
            for(let i=1; i<=4; i++) {
                const el = document.getElementById('q'+i), ex = shuffled[i-1], goal = Math.floor(ex.m * (0.7 + Math.random() * 0.3));
                el.classList.add('active');
                el.innerHTML = `<span>[ ${ex.n} ]</span><span>0 / ${goal} ${ex.u}</span>`;
            }
        }

        function switchTab(tab) {
            document.getElementById('stats-content').className = (tab === 'stats' ? '' : 'hidden');
            document.getElementById('inv-content').className = (tab === 'inv' ? '' : 'hidden');
            document.getElementById('btn-stats').classList.toggle('active', tab === 'stats');
            document.getElementById('btn-inv').classList.toggle('active', tab === 'inv');
        }

        function updateSystemStats() {
            const w = parseFloat(document.getElementById('weight').value) || 0, h = parseFloat(document.getElementById('height').value) || 0;
            const imc = h > 0 ? (w / ((h/100)**2)) : 0;
            document.getElementById('imc').innerText = imc.toFixed(1);
            let s = Math.floor(w/5), v = Math.floor(w/4.5), a = imc > 0 ? Math.floor(100/imc)*2 : 10;
            document.getElementById('s-str').innerText = s; document.getElementById('s-agi').innerText = a; document.getElementById('s-vit').innerText = v;
            if(radar) { radar.data.datasets[0].data = [s, a, v, 15, 15]; radar.update(); }
        }

        function saveData() {
            const data = { age: document.getElementById('age').value, h: document.getElementById('height').value, w: document.getElementById('weight').value, img: document.getElementById('img-hud').src };
            localStorage.setItem('gem_v18', JSON.stringify(data));
            updateSystemStats();
        }

        function loadData() {
            const d = JSON.parse(localStorage.getItem('gem_v18'));
            if(d) {
                document.getElementById('age').value = d.age; document.getElementById('height').value = d.h; document.getElementById('weight').value = d.w;
                document.getElementById('img-hud').src = d.img; document.getElementById('img-sys').src = d.img;
            }
            const fb = localStorage.getItem('gem_fb_v18');
            if(fb) document.getElementById('img-full-body').src = fb;
            updateSystemStats();
        }

        function previewImage(i) {
            if(!i.files[0]) return;
            const r = new FileReader(); r.onload = (e) => { document.getElementById('img-hud').src = e.target.result; document.getElementById('img-sys').src = e.target.result; saveData(); };
            r.readAsDataURL(i.files[0]);
        }

        function previewFullBody(i) {
            if(!i.files[0]) return;
            const r = new FileReader(); r.onload = (e) => { document.getElementById('img-full-body').src = e.target.result; localStorage.setItem('gem_fb_v18', e.target.result); };
            r.readAsDataURL(i.files[0]);
        }

        function toggleSystem() { document.getElementById('system-modal').classList.toggle('hidden'); if(!radar) initRadar(); }

        function initRadar() {
            radar = new Chart(document.getElementById('radarChart'), {
                type: 'radar',
                data: { labels: ['STR', 'AGI', 'VIT', 'INT', 'PER'], datasets: [{ data: [15,15,15,15,15], backgroundColor: 'rgba(0, 229, 255, 0.2)', borderColor: '#00e5ff', borderWidth: 2 }] },
                options: { maintainAspectRatio: false, scales: { r: { min: 0, max: 50, ticks: { display: false }, grid: { color: 'rgba(255,255,255,0.1)' } } }, plugins: { legend: { display: false } } }
            });
            updateSystemStats();
        }
    </script>
</body>
</html>
